AWSTemplateFormatVersion: '2010-09-09'
Description: CloudFormation template to create a CodeBuild project


Parameters: 
  RepositoryName: 
    Type: String 
    Description: Name of the CodeCommit repository
Resources:
  PythonHelloWorldCodeBuildProject:
    Type: AWS::CodeBuild::Project
    Properties:
      Name: python-hello-world-demo
      ServiceRole: arn:aws:iam::284818286831:role/codedeploy-role
      Source:
        Type: CODECOMMIT 
        Location: !Ref RepositoryName
      Artifacts:
        Type: S3
        Location: codepipeline-ab-demo
        Path: codebuild-artifacts
        Name: python-hello-world.zip
        Packaging: ZIP
        OverrideArtifactName: false
        EncryptionDisabled: true
      Environment:
        Type: LINUX_CONTAINER
        ComputeType: BUILD_GENERAL1_SMALL
        Image: aws/codebuild/amazonlinux-x86_64-standard:5.0
        PrivilegedMode: false
        ImagePullCredentialsType: CODEBUILD
      Cache:
        Type: S3
        Location: codepipeline-ab-demo/codebuild-cache
      TimeoutInMinutes: 45
      QueuedTimeoutInMinutes: 480
      LogsConfig:
        CloudWatchLogs:
          Status: ENABLED
          GroupName: codebuild/python-hello-world
          StreamName: python-hello-world
        S3Logs:
          Status: DISABLED
          EncryptionDisabled: false

Outputs:
  CodeBuildProjectName:
    Description: "CodeBuild project name"
    Value: !Ref PythonHelloWorldCodeBuildProject

  CodeBuildProjectLink:
    Description: "CodeBuild project"
    Value: !Sub >
      https://${AWS::Region}.console.aws.amazon.com/codesuite/codebuild/projects/${PythonHelloWorldCodeBuildProject}/build?region=${AWS::Region}
